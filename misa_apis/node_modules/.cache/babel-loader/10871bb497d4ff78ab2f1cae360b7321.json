{"ast":null,"code":"import { createCommentVNode as _createCommentVNode, createElementVNode as _createElementVNode, toDisplayString as _toDisplayString, createTextVNode as _createTextVNode, openBlock as _openBlock, createElementBlock as _createElementBlock, resolveComponent as _resolveComponent, createVNode as _createVNode, createStaticVNode as _createStaticVNode, Fragment as _Fragment, pushScopeId as _pushScopeId, popScopeId as _popScopeId } from \"vue\";\n\nconst _withScopeId = n => (_pushScopeId(\"data-v-19c0256c\"), n = n(), _popScopeId(), n);\n\nconst _hoisted_1 = {\n  class: \"dilog-import flex\"\n};\nconst _hoisted_2 = {\n  class: \"dialog-import-content\"\n};\n\nconst _hoisted_3 = /*#__PURE__*/_withScopeId(() => /*#__PURE__*/_createElementVNode(\"span\", {\n  class: \"popup-title\"\n}, \"Nhập khẩu\", -1\n/* HOISTED */\n));\n\nconst _hoisted_4 = /*#__PURE__*/_createStaticVNode(\"<div class=\\\"select-file flex\\\" data-v-19c0256c><div class=\\\"file-block\\\" data-v-19c0256c><div class=\\\"file-icon icon-import\\\" data-v-19c0256c></div><span class=\\\"file-title\\\" data-v-19c0256c>Click để chọn tệp nhập khẩu</span><div class=\\\"file-sample\\\" data-v-19c0256c>Tải tệp mẫu</div></div></div>\", 1);\n\nconst _hoisted_5 = {\n  class: \"record-of-file flex\"\n};\nconst _hoisted_6 = {\n  class: \"record-quantity bgi-valid margin-right-16 text-18 flex\"\n};\nconst _hoisted_7 = {\n  class: \"record-quantity invalid bgi-invalid text-18 flex\"\n};\nconst _hoisted_8 = {\n  key: 0,\n  class: \"text-16\"\n};\n\nconst _hoisted_9 = /*#__PURE__*/_createTextVNode(\"Tải xuống bản ghi bị lỗi \");\n\nconst _hoisted_10 = {\n  class: \"popup-button flex\"\n};\nexport function render(_ctx, _cache, $props, $setup, $data, $options) {\n  const _component_BaseButton = _resolveComponent(\"BaseButton\");\n\n  return _openBlock(), _createElementBlock(_Fragment, null, [_createCommentVNode(\" :class=\\\"{ hide: isHideDialogImport }\\\" \"), _createElementVNode(\"div\", _hoisted_1, [_createElementVNode(\"div\", _hoisted_2, [_hoisted_3, _createCommentVNode(\" <div class=\\\"block-item example-file bgi-upload-file flex\\\" @click=\\\"exportSampleExcel\\\">\\r\\n        Tải tệp mẫu\\r\\n      </div>\\r\\n      <div class=\\\"block-item upload-file bgi-upload-file flex\\\" @click=\\\"importFileOnClick\\\">\\r\\n        Chọn tệp nguồn\\r\\n      </div> \"), _hoisted_4, _createElementVNode(\"div\", _hoisted_5, [_createElementVNode(\"div\", _hoisted_6, \" Số bản ghi hợp lệ: \" + _toDisplayString($data.totalValid), 1\n  /* TEXT */\n  ), _createElementVNode(\"div\", _hoisted_7, \" Số bản ghi không hợp lệ: \" + _toDisplayString($data.totalInvalid), 1\n  /* TEXT */\n  )]), $data.totalInvalid > 0 ? (_openBlock(), _createElementBlock(\"span\", _hoisted_8, [_hoisted_9, _createElementVNode(\"span\", {\n    class: \"link-download\",\n    onClick: _cache[0] || (_cache[0] = (...args) => $options.exportInvalidUser && $options.exportInvalidUser(...args))\n  }, \"tại đây\")])) : _createCommentVNode(\"v-if\", true), _createElementVNode(\"div\", _hoisted_10, [_createElementVNode(\"div\", {\n    onClick: _cache[1] || (_cache[1] = (...args) => $options.closeDialog && $options.closeDialog(...args))\n  }, [_createVNode(_component_BaseButton, {\n    buttonType: \"white\",\n    buttonName: \"Đóng\"\n  })]), _createElementVNode(\"div\", {\n    title: \"Nhập khẩu những bản ghi hợp lệ\",\n    onClick: _cache[2] || (_cache[2] = (...args) => $options.importValidUser && $options.importValidUser(...args))\n  }, [_createVNode(_component_BaseButton, {\n    buttonType: \"regular\",\n    buttonName: \"Nhập khẩu\"\n  })])])]), _createElementVNode(\"input\", {\n    hidden: \"\",\n    type: \"file\",\n    ref: \"fileImport\",\n    id: \"fileImport\",\n    onChange: _cache[3] || (_cache[3] = (...args) => $options.changeFile && $options.changeFile(...args))\n  }, null, 544\n  /* HYDRATE_EVENTS, NEED_PATCH */\n  )])], 2112\n  /* STABLE_FRAGMENT, DEV_ROOT_FRAGMENT */\n  );\n}","map":{"version":3,"mappings":";;;;;EAEOA,KAAK,EAAC;;;EAEJA,KAAK,EAAC;;;gEACTC,oBAA0C,MAA1C,EAA0C;EAApCD,KAAK,EAAC;AAA8B,CAA1C,EAA0B,WAA1B,EAAmC;AAAA;AAAnC;;;;;EAcKA,KAAK,EAAC;;;EACJA,KAAK,EAAC;;;EAGNA,KAAK,EAAC;;;;EAIiBA,KAAK,EAAC;;;iDACjC;;;EAKEA,KAAK,EAAC;;;;;6DAhCjBE,kEACED,oBA+CM,KA/CN,cA+CM,CA7CJA,oBAqCM,KArCN,cAqCM,CApCJE,UAoCI,EAnCJD,qSAmCI,EA7BJE,UA6BI,EAtBJH,oBAOM,KAPN,cAOM,CANJA,oBAEM,KAFN,cAAoE,yBAC1CI,iBAAGC,gBAAH,CAD1B,EACuC;EAAA;EADvC,CAMI,EAHJL,oBAEM,KAFN,cAA8D,+BAC9BI,iBAAGC,kBAAH,CADhC,EAC+C;EAAA;EAD/C,CAGI,CAPN,CAsBI,EAdQA,qBAAY,mBAAxBC,oBAKC,MALD,cAKC,aAHCN,oBAEC,MAFD,EAEC;IAFKD,KAAK,EAAC,eAEX;IAF4BQ,OAAK,yCAAEC,iEAAF;EAEjC,CAFD,EACG,SADH,CAGD,CALD,sCAcI,EARJR,oBAOM,KAPN,eAOM,CANJA,oBAEM,KAFN,EAEM;IAFAO,OAAK,yCAAEC,qDAAF;EAEL,CAFN,GACEC,aAAmDC,qBAAnD,EAAmD;IAAvCC,UAAU,EAAC,OAA4B;IAApBC,UAAU,EAAC;EAAS,CAAnD,EADF,CAMI,EAHJZ,oBAEM,KAFN,EAEM;IAFDa,KAAK,EAAC,gCAEL;IAFuCN,OAAK,yCAAEC,6DAAF;EAE5C,CAFN,GACEC,aAA0DC,qBAA1D,EAA0D;IAA9CC,UAAU,EAAC,SAAmC;IAAzBC,UAAU,EAAC;EAAc,CAA1D,EADF,CAGI,CAPN,CAQI,CArCN,CA6CI,EAPJZ,oBAME,OANF,EAME;IALAc,MAAM,EAAN,EAKA;IAJAC,IAAI,EAAC,MAIL;IAHAC,GAAG,EAAC,YAGJ;IAFAC,EAAE,EAAC,YAEH;IADCC,QAAM,yCAAEV,mDAAF;EACP,CANF;;EAAA,CAOI,CA/CN","names":["class","_createElementVNode","_createCommentVNode","_hoisted_3","_hoisted_4","_toDisplayString","$data","_createElementBlock","onClick","$options","_createVNode","_component_BaseButton","buttonType","buttonName","title","hidden","type","ref","id","onChange"],"sourceRoot":"","sources":["E:\\MisaProject\\MISA_APIS\\misa_apis\\src\\screens\\establish\\user\\DialogImport.vue"],"sourcesContent":["<template>\r\n<!-- :class=\"{ hide: isHideDialogImport }\" -->\r\n  <div class=\"dilog-import flex\" >\r\n    \r\n    <div class=\"dialog-import-content\">\r\n      <span class=\"popup-title\">Nhập khẩu</span>\r\n      <!-- <div class=\"block-item example-file bgi-upload-file flex\" @click=\"exportSampleExcel\">\r\n        Tải tệp mẫu\r\n      </div>\r\n      <div class=\"block-item upload-file bgi-upload-file flex\" @click=\"importFileOnClick\">\r\n        Chọn tệp nguồn\r\n      </div> -->\r\n      <div class=\"select-file flex\">\r\n        <div class=\"file-block\">\r\n          <div class=\"file-icon icon-import\"></div>\r\n          <span class=\"file-title\">Click để chọn tệp nhập khẩu</span>\r\n          <div class=\"file-sample\">Tải tệp mẫu</div>\r\n        </div>\r\n      </div>\r\n      <div class=\"record-of-file flex\">\r\n        <div class=\"record-quantity bgi-valid margin-right-16 text-18 flex\">\r\n          Số bản ghi hợp lệ:&nbsp;{{ totalValid }}\r\n        </div>\r\n        <div class=\"record-quantity invalid bgi-invalid text-18 flex\">\r\n          Số bản ghi không hợp lệ:&nbsp;{{ totalInvalid }}\r\n        </div>\r\n      </div>\r\n      <span v-if=\"totalInvalid > 0\" class=\"text-16\"\r\n        >Tải xuống bản ghi bị lỗi\r\n        <span class=\"link-download\" @click=\"exportInvalidUser\"\r\n          >tại đây</span\r\n        ></span\r\n      >\r\n      <div class=\"popup-button flex\">\r\n        <div @click=\"closeDialog\">\r\n          <BaseButton buttonType=\"white\" buttonName=\"Đóng\" />\r\n        </div>\r\n        <div title=\"Nhập khẩu những bản ghi hợp lệ\" @click=\"importValidUser\">\r\n          <BaseButton buttonType=\"regular\" buttonName=\"Nhập khẩu\" />\r\n        </div>\r\n      </div>\r\n    </div>\r\n    <input\r\n      hidden\r\n      type=\"file\"\r\n      ref=\"fileImport\"\r\n      id=\"fileImport\"\r\n      @change=\"changeFile\"\r\n    />\r\n  </div>\r\n</template>\r\n\r\n<script>\r\nimport axios from \"axios\";\r\nimport BaseApi from '../../../constants/BaseApi'\r\nexport default {\r\n  props: [\"isHideDialogImport\"],\r\n  data() {\r\n    return {\r\n      inputFile: null,\r\n      totalValid: null,\r\n      totalInvalid: null,\r\n      validUsers: [],\r\n      invalidUsers: [],\r\n    };\r\n  },\r\n  methods: {\r\n    /**\r\n     * Đóng dialog nhập khẩu\r\n     * Author: VQBao - 20/9/2022\r\n     */\r\n    closeDialog() {\r\n      this.$emit(\"hideDialogImport\", true);\r\n      this.$refs.fileImport.value = null;\r\n      this.totalValid = null;\r\n      this.totalInvalid = null;\r\n      this.validUsers = [];\r\n      this.invalidUsers = [];\r\n    },\r\n\r\n    /**\r\n     * Khi click vào button nhập khẩu, tạo sự kiện click chọn file của input\r\n     */\r\n    importFileOnClick() {\r\n      this.$refs.fileImport.click();\r\n    },\r\n\r\n    /**\r\n     * Khi chọn xong file thì thực hiện gọi api lấy dữ liệu số bản ghi hợp lệ, bản ghi lỗi, danh sách bản ghi hợp lệ, danh sách bản ghi lỗi\r\n     * Author: VQBao - 20/9/2022\r\n     */\r\n    async changeFile() {\r\n      var formImport = new FormData();\r\n      this.inputFile = document.getElementById(\"fileImport\").files[0];\r\n      formImport.append(\"fileImport\", this.inputFile);\r\n      if (this.inputFile != null) {\r\n        try {\r\n          await axios.post(\"https://localhost:44382/api/v1/Users/GetImportQuantity\", formImport,{\r\n                headers: {\r\n                  \"Content-Type\": \"multipart/form-data\",\r\n                },\r\n              }\r\n            )\r\n            .then((response) => {\r\n              this.totalValid = response.data.TotalValid;\r\n              this.totalInvalid = response.data.TotalInvalid;\r\n              this.validUsers = response.data.ValidUsers;\r\n              this.invalidUsers = response.data.InvalidUsers;\r\n            });\r\n        } catch (error) {\r\n          console.log(error);\r\n        }\r\n      }\r\n    },\r\n\r\n    /**\r\n     * Khi click vào tải file mẫu, gọi api tải về file excel nhập liệu mẫu\r\n     * Author: VQBao - 20/9/2022\r\n     */\r\n    exportSampleExcel() {\r\n      document.getElementById(\"loader\").style.display = \"block\";\r\n      try {\r\n        axios({\r\n          url: \"https://localhost:44382/api/v1/Users/ExportSampleExcel\",\r\n          method: \"GET\",\r\n          responseType: \"blob\",\r\n        }).then((response) => {\r\n          document.getElementById(\"loader\").style.display = \"none\";\r\n          var fileURL = window.URL.createObjectURL(new Blob([response.data]));\r\n          var fileLink = document.createElement(\"a\");\r\n\r\n          fileLink.href = fileURL;\r\n          fileLink.setAttribute(\"download\", \"Danh_sach_mau.xlsx\");\r\n          document.body.appendChild(fileLink);\r\n          fileLink.click();\r\n        });\r\n      } catch (error) {\r\n        document.getElementById(\"loader\").style.display = \"none\";\r\n        console.log(error);\r\n      }\r\n    },\r\n\r\n    /**\r\n     * Khi click chọn nhập khẩu, gọi api nhập khẩu những bản ghi hợp lệ\r\n     * Author: VQBao - 20/9/2022\r\n     */\r\n    importValidUser() {\r\n      document.getElementById(\"loader\").style.display = \"block\";\r\n      if (this.validUsers.length > 0) {\r\n        try {\r\n          axios.post(\r\n            \"https://localhost:44382/api/v1/Users/Import\", this.validUsers,{\r\n              headers: {\r\n                \"Content-Type\": \"application/json\",\r\n              },\r\n            }\r\n          )\r\n          .then(() => {\r\n            document.getElementById(\"loader\").style.display = \"none\";\r\n            this.validUsers = [];\r\n            this.$emit(\"hideToast\", \"Nhập khẩu người dùng thành công\");\r\n            this.$emit(\"loadData\")\r\n          });\r\n        } catch (error) {\r\n          document.getElementById(\"loader\").style.display = \"none\";\r\n          console.log(error);\r\n        }\r\n      }\r\n    },\r\n\r\n    /**\r\n     * Xuất khẩu ra file excel những bản ghi bị lỗi\r\n     * Author: VQBao - 20/9/2022\r\n     */\r\n    exportInvalidUser() {\r\n      if (this.invalidUsers.length > 0) {\r\n        try {\r\n          this.export(BaseApi.UserApi+\"/ExportInvalidUser\",this.invalidUsers, \"Danh_sach_nguoi_dung_loi.xlsx\");\r\n          this.invalidUsers = [];\r\n        } catch (error) {\r\n          console.log(error);\r\n        }\r\n      }\r\n    },\r\n    /**\r\n     * Hàm xuất khẩu chung\r\n     * Author: VQBao - 20/9/2022\r\n     */\r\n    export(urlApi ,users, fileName){\r\n      try {\r\n          axios({\r\n            url: urlApi,\r\n            method: \"POST\",\r\n            data: users,\r\n            responseType: \"blob\",\r\n          }).then((response) => {\r\n            var fileURL = window.URL.createObjectURL(new Blob([response.data]));\r\n            var fileLink = document.createElement(\"a\");\r\n\r\n            fileLink.href = fileURL;\r\n            fileLink.setAttribute(\"download\", fileName);\r\n            document.body.appendChild(fileLink);\r\n            fileLink.click();\r\n          });\r\n        } catch (error) {\r\n          console.log(error);\r\n        }\r\n    },\r\n  },\r\n};\r\n</script>\r\n\r\n<style scoped>\r\n.hide {\r\n  display: none !important;\r\n}\r\n.dilog-import {\r\n  position: fixed;\r\n  align-items: center;\r\n  justify-content: center;\r\n  top: 0;\r\n  left: 0;\r\n  right: 0;\r\n  bottom: 0;\r\n  background-color: rgba(0, 0, 0, 0.24);\r\n  z-index: 99;\r\n  box-sizing: border-box;\r\n}\r\n.popup-title {\r\n  font-size: 24px;\r\n  margin-bottom: 16px;\r\n}\r\n.dialog-import-content {\r\n  width: 560px;\r\n  background-color: #ffffff;\r\n  position: relative;\r\n  display: flex;\r\n  flex-direction: column;\r\n  padding: 24px 24px;\r\n  box-sizing: border-box;\r\n}\r\n.block-item {\r\n  width: 100%;\r\n  height: 60px;\r\n  box-sizing: border-box;\r\n  background-color: aquamarine;\r\n  font-size: 20px;\r\n  font-weight: 700;\r\n  justify-content: center;\r\n  border: 1px solid;\r\n  border-radius: 4px;\r\n}\r\n.text-18 {\r\n  font-size: 16px;\r\n  font-weight: 600;\r\n}\r\n.example-file {\r\n  border-color: #e0e5e6;\r\n  background-color: var(--primary);\r\n  color: #fff !important;\r\n  cursor: pointer;\r\n  background-size: cover;\r\n}\r\n.upload-file {\r\n  background-color: var(--primary);\r\n  color: #fff;\r\n  margin: 16px 0;\r\n  cursor: pointer;\r\n}\r\n.record-quantity {\r\n  width: 248px;\r\n  height: 60px;\r\n  background-color: var(--primary);\r\n  box-sizing: border-box;\r\n  padding-left: 16px;\r\n  margin-bottom: 16px;\r\n  color: #fff;\r\n}\r\n.invalid {\r\n  background-color: rgb(245, 155, 107);\r\n}\r\n.margin-right-16 {\r\n  margin-right: 16px;\r\n}\r\n.text-16 {\r\n  font-size: 16px;\r\n}\r\n.link-download {\r\n  font-weight: 600;\r\n  cursor: pointer;\r\n}\r\n\r\n.popup-button {\r\n  justify-content: flex-end;\r\n  margin-top: 24px;\r\n}\r\n.select-file {\r\n  width: 100%;\r\n  height: 240px;\r\n  background-color: aquamarine;\r\n  border: 1px #ccc;\r\n  border-style: dashed !important;\r\n  box-sizing: border-box;\r\n}\r\n.file-icon {\r\n  width: 50px;\r\n  height: 50px;\r\n}\r\n.file-title {\r\n  color: #757575;\r\n}\r\n</style>"]},"metadata":{},"sourceType":"module"}